{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Train and Evaluate"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/Users/adam/anaconda3/envs/tensortrade/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\n",
      "  _np_qint8 = np.dtype([(\"qint8\", np.int8, 1)])\n",
      "/Users/adam/anaconda3/envs/tensortrade/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\n",
      "  _np_quint8 = np.dtype([(\"quint8\", np.uint8, 1)])\n",
      "/Users/adam/anaconda3/envs/tensortrade/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\n",
      "  _np_qint16 = np.dtype([(\"qint16\", np.int16, 1)])\n",
      "/Users/adam/anaconda3/envs/tensortrade/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\n",
      "  _np_quint16 = np.dtype([(\"quint16\", np.uint16, 1)])\n",
      "/Users/adam/anaconda3/envs/tensortrade/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\n",
      "  _np_qint32 = np.dtype([(\"qint32\", np.int32, 1)])\n",
      "/Users/adam/anaconda3/envs/tensortrade/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\n",
      "  np_resource = np.dtype([(\"resource\", np.ubyte, 1)])\n",
      "/Users/adam/anaconda3/envs/tensortrade/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\n",
      "  _np_qint8 = np.dtype([(\"qint8\", np.int8, 1)])\n",
      "/Users/adam/anaconda3/envs/tensortrade/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\n",
      "  _np_quint8 = np.dtype([(\"quint8\", np.uint8, 1)])\n",
      "/Users/adam/anaconda3/envs/tensortrade/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\n",
      "  _np_qint16 = np.dtype([(\"qint16\", np.int16, 1)])\n",
      "/Users/adam/anaconda3/envs/tensortrade/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\n",
      "  _np_quint16 = np.dtype([(\"quint16\", np.uint16, 1)])\n",
      "/Users/adam/anaconda3/envs/tensortrade/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\n",
      "  _np_qint32 = np.dtype([(\"qint32\", np.int32, 1)])\n",
      "/Users/adam/anaconda3/envs/tensortrade/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\n",
      "  np_resource = np.dtype([(\"resource\", np.ubyte, 1)])\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "-------------------------------------\n",
      "| approxkl           | 0.015686866  |\n",
      "| clipfrac           | 0.19921875   |\n",
      "| explained_variance | -11.1        |\n",
      "| fps                | 7            |\n",
      "| n_updates          | 1            |\n",
      "| policy_entropy     | 3.134857     |\n",
      "| policy_loss        | -0.029379755 |\n",
      "| serial_timesteps   | 128          |\n",
      "| time_elapsed       | 2.15e-06     |\n",
      "| total_timesteps    | 128          |\n",
      "| value_loss         | 0.020201866  |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.004347246  |\n",
      "| clipfrac           | 0.056640625  |\n",
      "| explained_variance | -31.4        |\n",
      "| fps                | 67           |\n",
      "| n_updates          | 2            |\n",
      "| policy_entropy     | 3.1364708    |\n",
      "| policy_loss        | -0.034043223 |\n",
      "| serial_timesteps   | 256          |\n",
      "| time_elapsed       | 17.8         |\n",
      "| total_timesteps    | 256          |\n",
      "| value_loss         | 0.016545191  |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0041049235 |\n",
      "| clipfrac           | 0.056640625  |\n",
      "| explained_variance | -26.2        |\n",
      "| fps                | 71           |\n",
      "| n_updates          | 3            |\n",
      "| policy_entropy     | 3.1393285    |\n",
      "| policy_loss        | -0.032377902 |\n",
      "| serial_timesteps   | 384          |\n",
      "| time_elapsed       | 19.7         |\n",
      "| total_timesteps    | 384          |\n",
      "| value_loss         | 0.012273217  |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.006468634  |\n",
      "| clipfrac           | 0.09375      |\n",
      "| explained_variance | -2.42        |\n",
      "| fps                | 69           |\n",
      "| n_updates          | 4            |\n",
      "| policy_entropy     | 3.1348906    |\n",
      "| policy_loss        | -0.03826902  |\n",
      "| serial_timesteps   | 512          |\n",
      "| time_elapsed       | 21.5         |\n",
      "| total_timesteps    | 512          |\n",
      "| value_loss         | 0.0066311737 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.007191459  |\n",
      "| clipfrac           | 0.1015625    |\n",
      "| explained_variance | -16          |\n",
      "| fps                | 69           |\n",
      "| n_updates          | 5            |\n",
      "| policy_entropy     | 3.1227515    |\n",
      "| policy_loss        | -0.038608577 |\n",
      "| serial_timesteps   | 640          |\n",
      "| time_elapsed       | 23.3         |\n",
      "| total_timesteps    | 640          |\n",
      "| value_loss         | 0.012630895  |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0045953994 |\n",
      "| clipfrac           | 0.060546875  |\n",
      "| explained_variance | -3.16        |\n",
      "| fps                | 68           |\n",
      "| n_updates          | 6            |\n",
      "| policy_entropy     | 3.1100907    |\n",
      "| policy_loss        | -0.035558037 |\n",
      "| serial_timesteps   | 768          |\n",
      "| time_elapsed       | 25.2         |\n",
      "| total_timesteps    | 768          |\n",
      "| value_loss         | 0.009172132  |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.009143541  |\n",
      "| clipfrac           | 0.103515625  |\n",
      "| explained_variance | -19.3        |\n",
      "| fps                | 71           |\n",
      "| n_updates          | 7            |\n",
      "| policy_entropy     | 3.1050773    |\n",
      "| policy_loss        | -0.035926923 |\n",
      "| serial_timesteps   | 896          |\n",
      "| time_elapsed       | 27           |\n",
      "| total_timesteps    | 896          |\n",
      "| value_loss         | 0.0067858095 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.003506794  |\n",
      "| clipfrac           | 0.037109375  |\n",
      "| explained_variance | -11.9        |\n",
      "| fps                | 70           |\n",
      "| n_updates          | 8            |\n",
      "| policy_entropy     | 3.1087527    |\n",
      "| policy_loss        | -0.03510943  |\n",
      "| serial_timesteps   | 1024         |\n",
      "| time_elapsed       | 28.8         |\n",
      "| total_timesteps    | 1024         |\n",
      "| value_loss         | 0.0060115107 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0057391115 |\n",
      "| clipfrac           | 0.076171875  |\n",
      "| explained_variance | -21.9        |\n",
      "| fps                | 68           |\n",
      "| n_updates          | 9            |\n",
      "| policy_entropy     | 3.0899982    |\n",
      "| policy_loss        | -0.04027173  |\n",
      "| serial_timesteps   | 1152         |\n",
      "| time_elapsed       | 30.7         |\n",
      "| total_timesteps    | 1152         |\n",
      "| value_loss         | 0.008043544  |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.007443852  |\n",
      "| clipfrac           | 0.10546875   |\n",
      "| explained_variance | -6.41        |\n",
      "| fps                | 71           |\n",
      "| n_updates          | 10           |\n",
      "| policy_entropy     | 3.0799294    |\n",
      "| policy_loss        | -0.030166402 |\n",
      "| serial_timesteps   | 1280         |\n",
      "| time_elapsed       | 32.5         |\n",
      "| total_timesteps    | 1280         |\n",
      "| value_loss         | 0.007881636  |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0044689896 |\n",
      "| clipfrac           | 0.060546875  |\n",
      "| explained_variance | -3           |\n",
      "| fps                | 69           |\n",
      "| n_updates          | 11           |\n",
      "| policy_entropy     | 3.077082     |\n",
      "| policy_loss        | -0.02097323  |\n",
      "| serial_timesteps   | 1408         |\n",
      "| time_elapsed       | 34.3         |\n",
      "| total_timesteps    | 1408         |\n",
      "| value_loss         | 0.005172204  |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0050849114 |\n",
      "| clipfrac           | 0.06640625   |\n",
      "| explained_variance | -2.86        |\n",
      "| fps                | 71           |\n",
      "| n_updates          | 12           |\n",
      "| policy_entropy     | 3.0792596    |\n",
      "| policy_loss        | -0.031660907 |\n",
      "| serial_timesteps   | 1536         |\n",
      "| time_elapsed       | 36.2         |\n",
      "| total_timesteps    | 1536         |\n",
      "| value_loss         | 0.0035120992 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.005501705  |\n",
      "| clipfrac           | 0.072265625  |\n",
      "| explained_variance | -6.78        |\n",
      "| fps                | 69           |\n",
      "| n_updates          | 13           |\n",
      "| policy_entropy     | 3.0667455    |\n",
      "| policy_loss        | -0.0353304   |\n",
      "| serial_timesteps   | 1664         |\n",
      "| time_elapsed       | 38           |\n",
      "| total_timesteps    | 1664         |\n",
      "| value_loss         | 0.0035197046 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0034935924 |\n",
      "| clipfrac           | 0.03515625   |\n",
      "| explained_variance | -1.97        |\n",
      "| fps                | 70           |\n",
      "| n_updates          | 14           |\n",
      "| policy_entropy     | 3.0474973    |\n",
      "| policy_loss        | -0.02214749  |\n",
      "| serial_timesteps   | 1792         |\n",
      "| time_elapsed       | 39.8         |\n",
      "| total_timesteps    | 1792         |\n",
      "| value_loss         | 0.008100608  |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0050987806 |\n",
      "| clipfrac           | 0.07421875   |\n",
      "| explained_variance | -7.62        |\n",
      "| fps                | 69           |\n",
      "| n_updates          | 15           |\n",
      "| policy_entropy     | 3.013968     |\n",
      "| policy_loss        | -0.035785682 |\n",
      "| serial_timesteps   | 1920         |\n",
      "| time_elapsed       | 41.6         |\n",
      "| total_timesteps    | 1920         |\n",
      "| value_loss         | 0.005753589  |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0042615556 |\n",
      "| clipfrac           | 0.048828125  |\n",
      "| explained_variance | -3.22        |\n",
      "| fps                | 69           |\n",
      "| n_updates          | 16           |\n",
      "| policy_entropy     | 3.054264     |\n",
      "| policy_loss        | -0.025227852 |\n",
      "| serial_timesteps   | 2048         |\n",
      "| time_elapsed       | 43.5         |\n",
      "| total_timesteps    | 2048         |\n",
      "| value_loss         | 0.0059471955 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0046438547 |\n",
      "| clipfrac           | 0.06640625   |\n",
      "| explained_variance | -11.8        |\n",
      "| fps                | 69           |\n",
      "| n_updates          | 17           |\n",
      "| policy_entropy     | 3.0322256    |\n",
      "| policy_loss        | -0.035015304 |\n",
      "| serial_timesteps   | 2176         |\n",
      "| time_elapsed       | 45.3         |\n",
      "| total_timesteps    | 2176         |\n",
      "| value_loss         | 0.0070840833 |\n",
      "-------------------------------------\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "-------------------------------------\n",
      "| approxkl           | 0.003370538  |\n",
      "| clipfrac           | 0.029296875  |\n",
      "| explained_variance | -13.7        |\n",
      "| fps                | 70           |\n",
      "| n_updates          | 18           |\n",
      "| policy_entropy     | 3.0704434    |\n",
      "| policy_loss        | -0.023219515 |\n",
      "| serial_timesteps   | 2304         |\n",
      "| time_elapsed       | 47.2         |\n",
      "| total_timesteps    | 2304         |\n",
      "| value_loss         | 0.0028484792 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.006409786  |\n",
      "| clipfrac           | 0.091796875  |\n",
      "| explained_variance | -9.48        |\n",
      "| fps                | 70           |\n",
      "| n_updates          | 19           |\n",
      "| policy_entropy     | 2.987904     |\n",
      "| policy_loss        | -0.035213843 |\n",
      "| serial_timesteps   | 2432         |\n",
      "| time_elapsed       | 49           |\n",
      "| total_timesteps    | 2432         |\n",
      "| value_loss         | 0.0047854204 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.006497549  |\n",
      "| clipfrac           | 0.09375      |\n",
      "| explained_variance | -11.7        |\n",
      "| fps                | 68           |\n",
      "| n_updates          | 20           |\n",
      "| policy_entropy     | 2.9115448    |\n",
      "| policy_loss        | -0.030990526 |\n",
      "| serial_timesteps   | 2560         |\n",
      "| time_elapsed       | 50.8         |\n",
      "| total_timesteps    | 2560         |\n",
      "| value_loss         | 0.004396537  |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0057365038 |\n",
      "| clipfrac           | 0.076171875  |\n",
      "| explained_variance | -3.01        |\n",
      "| fps                | 71           |\n",
      "| n_updates          | 21           |\n",
      "| policy_entropy     | 3.0100975    |\n",
      "| policy_loss        | -0.030712336 |\n",
      "| serial_timesteps   | 2688         |\n",
      "| time_elapsed       | 52.7         |\n",
      "| total_timesteps    | 2688         |\n",
      "| value_loss         | 0.0028251242 |\n",
      "-------------------------------------\n",
      "------------------------------------\n",
      "| approxkl           | 0.012113415 |\n",
      "| clipfrac           | 0.17773438  |\n",
      "| explained_variance | -6.15       |\n",
      "| fps                | 67          |\n",
      "| n_updates          | 22          |\n",
      "| policy_entropy     | 2.9067888   |\n",
      "| policy_loss        | -0.03025525 |\n",
      "| serial_timesteps   | 2816        |\n",
      "| time_elapsed       | 54.5        |\n",
      "| total_timesteps    | 2816        |\n",
      "| value_loss         | 0.00661547  |\n",
      "------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0146746095 |\n",
      "| clipfrac           | 0.21484375   |\n",
      "| explained_variance | -8.17        |\n",
      "| fps                | 69           |\n",
      "| n_updates          | 23           |\n",
      "| policy_entropy     | 2.944471     |\n",
      "| policy_loss        | -0.025846934 |\n",
      "| serial_timesteps   | 2944         |\n",
      "| time_elapsed       | 56.4         |\n",
      "| total_timesteps    | 2944         |\n",
      "| value_loss         | 0.007340616  |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0034283446 |\n",
      "| clipfrac           | 0.046875     |\n",
      "| explained_variance | -14.4        |\n",
      "| fps                | 69           |\n",
      "| n_updates          | 24           |\n",
      "| policy_entropy     | 2.9670064    |\n",
      "| policy_loss        | -0.030686371 |\n",
      "| serial_timesteps   | 3072         |\n",
      "| time_elapsed       | 58.2         |\n",
      "| total_timesteps    | 3072         |\n",
      "| value_loss         | 0.003749698  |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0066144066 |\n",
      "| clipfrac           | 0.08203125   |\n",
      "| explained_variance | -15          |\n",
      "| fps                | 69           |\n",
      "| n_updates          | 25           |\n",
      "| policy_entropy     | 2.890479     |\n",
      "| policy_loss        | -0.03531905  |\n",
      "| serial_timesteps   | 3200         |\n",
      "| time_elapsed       | 60           |\n",
      "| total_timesteps    | 3200         |\n",
      "| value_loss         | 0.005126408  |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.003699907  |\n",
      "| clipfrac           | 0.046875     |\n",
      "| explained_variance | -16.7        |\n",
      "| fps                | 68           |\n",
      "| n_updates          | 26           |\n",
      "| policy_entropy     | 2.92478      |\n",
      "| policy_loss        | -0.018177195 |\n",
      "| serial_timesteps   | 3328         |\n",
      "| time_elapsed       | 61.9         |\n",
      "| total_timesteps    | 3328         |\n",
      "| value_loss         | 0.0030545066 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.002150026  |\n",
      "| clipfrac           | 0.01953125   |\n",
      "| explained_variance | -5.88        |\n",
      "| fps                | 70           |\n",
      "| n_updates          | 27           |\n",
      "| policy_entropy     | 2.8929558    |\n",
      "| policy_loss        | -0.021653675 |\n",
      "| serial_timesteps   | 3456         |\n",
      "| time_elapsed       | 63.7         |\n",
      "| total_timesteps    | 3456         |\n",
      "| value_loss         | 0.0018296412 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0032687292 |\n",
      "| clipfrac           | 0.0390625    |\n",
      "| explained_variance | -1.25        |\n",
      "| fps                | 68           |\n",
      "| n_updates          | 28           |\n",
      "| policy_entropy     | 2.8655734    |\n",
      "| policy_loss        | -0.019367348 |\n",
      "| serial_timesteps   | 3584         |\n",
      "| time_elapsed       | 65.6         |\n",
      "| total_timesteps    | 3584         |\n",
      "| value_loss         | 0.0035883968 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0031826072 |\n",
      "| clipfrac           | 0.03515625   |\n",
      "| explained_variance | -13.6        |\n",
      "| fps                | 71           |\n",
      "| n_updates          | 29           |\n",
      "| policy_entropy     | 3.0322828    |\n",
      "| policy_loss        | -0.019959493 |\n",
      "| serial_timesteps   | 3712         |\n",
      "| time_elapsed       | 67.4         |\n",
      "| total_timesteps    | 3712         |\n",
      "| value_loss         | 0.0012646548 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0046773874 |\n",
      "| clipfrac           | 0.060546875  |\n",
      "| explained_variance | -4.85        |\n",
      "| fps                | 69           |\n",
      "| n_updates          | 30           |\n",
      "| policy_entropy     | 2.8930268    |\n",
      "| policy_loss        | -0.023547584 |\n",
      "| serial_timesteps   | 3840         |\n",
      "| time_elapsed       | 69.2         |\n",
      "| total_timesteps    | 3840         |\n",
      "| value_loss         | 0.0041705496 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0043210257 |\n",
      "| clipfrac           | 0.068359375  |\n",
      "| explained_variance | -6.2         |\n",
      "| fps                | 69           |\n",
      "| n_updates          | 31           |\n",
      "| policy_entropy     | 2.8908312    |\n",
      "| policy_loss        | -0.019220026 |\n",
      "| serial_timesteps   | 3968         |\n",
      "| time_elapsed       | 71.1         |\n",
      "| total_timesteps    | 3968         |\n",
      "| value_loss         | 0.0037358692 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0040041767 |\n",
      "| clipfrac           | 0.04296875   |\n",
      "| explained_variance | -6.06        |\n",
      "| fps                | 68           |\n",
      "| n_updates          | 32           |\n",
      "| policy_entropy     | 2.9260547    |\n",
      "| policy_loss        | -0.016887084 |\n",
      "| serial_timesteps   | 4096         |\n",
      "| time_elapsed       | 72.9         |\n",
      "| total_timesteps    | 4096         |\n",
      "| value_loss         | 0.0020238855 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0012021571 |\n",
      "| clipfrac           | 0.0078125    |\n",
      "| explained_variance | -12.6        |\n",
      "| fps                | 69           |\n",
      "| n_updates          | 33           |\n",
      "| policy_entropy     | 2.93147      |\n",
      "| policy_loss        | -0.017369535 |\n",
      "| serial_timesteps   | 4224         |\n",
      "| time_elapsed       | 74.8         |\n",
      "| total_timesteps    | 4224         |\n",
      "| value_loss         | 0.0013570841 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0019108081 |\n",
      "| clipfrac           | 0.017578125  |\n",
      "| explained_variance | -15          |\n",
      "| fps                | 68           |\n",
      "| n_updates          | 34           |\n",
      "| policy_entropy     | 2.9702377    |\n",
      "| policy_loss        | -0.018420639 |\n",
      "| serial_timesteps   | 4352         |\n",
      "| time_elapsed       | 76.6         |\n",
      "| total_timesteps    | 4352         |\n",
      "| value_loss         | 0.0011553135 |\n",
      "-------------------------------------\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "-------------------------------------\n",
      "| approxkl           | 0.0025978086 |\n",
      "| clipfrac           | 0.0234375    |\n",
      "| explained_variance | -8.3         |\n",
      "| fps                | 70           |\n",
      "| n_updates          | 35           |\n",
      "| policy_entropy     | 2.9254403    |\n",
      "| policy_loss        | -0.021094114 |\n",
      "| serial_timesteps   | 4480         |\n",
      "| time_elapsed       | 78.5         |\n",
      "| total_timesteps    | 4480         |\n",
      "| value_loss         | 0.0015350427 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.006608707  |\n",
      "| clipfrac           | 0.056640625  |\n",
      "| explained_variance | -26.4        |\n",
      "| fps                | 67           |\n",
      "| n_updates          | 36           |\n",
      "| policy_entropy     | 2.913075     |\n",
      "| policy_loss        | -0.024067963 |\n",
      "| serial_timesteps   | 4608         |\n",
      "| time_elapsed       | 80.3         |\n",
      "| total_timesteps    | 4608         |\n",
      "| value_loss         | 0.0035330513 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0019106918 |\n",
      "| clipfrac           | 0.017578125  |\n",
      "| explained_variance | -55          |\n",
      "| fps                | 66           |\n",
      "| n_updates          | 37           |\n",
      "| policy_entropy     | 2.8730893    |\n",
      "| policy_loss        | -0.017963056 |\n",
      "| serial_timesteps   | 4736         |\n",
      "| time_elapsed       | 82.2         |\n",
      "| total_timesteps    | 4736         |\n",
      "| value_loss         | 0.0036009694 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0031097014 |\n",
      "| clipfrac           | 0.044921875  |\n",
      "| explained_variance | -9.51        |\n",
      "| fps                | 70           |\n",
      "| n_updates          | 38           |\n",
      "| policy_entropy     | 2.959231     |\n",
      "| policy_loss        | -0.01630649  |\n",
      "| serial_timesteps   | 4864         |\n",
      "| time_elapsed       | 84.2         |\n",
      "| total_timesteps    | 4864         |\n",
      "| value_loss         | 0.002043393  |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0055523003 |\n",
      "| clipfrac           | 0.078125     |\n",
      "| explained_variance | -6.08        |\n",
      "| fps                | 69           |\n",
      "| n_updates          | 39           |\n",
      "| policy_entropy     | 2.9998493    |\n",
      "| policy_loss        | -0.015639752 |\n",
      "| serial_timesteps   | 4992         |\n",
      "| time_elapsed       | 86           |\n",
      "| total_timesteps    | 4992         |\n",
      "| value_loss         | 0.0021584725 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0026856214 |\n",
      "| clipfrac           | 0.037109375  |\n",
      "| explained_variance | -1.6         |\n",
      "| fps                | 69           |\n",
      "| n_updates          | 40           |\n",
      "| policy_entropy     | 2.9725153    |\n",
      "| policy_loss        | -0.02278446  |\n",
      "| serial_timesteps   | 5120         |\n",
      "| time_elapsed       | 87.8         |\n",
      "| total_timesteps    | 5120         |\n",
      "| value_loss         | 0.0015180153 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0050681173 |\n",
      "| clipfrac           | 0.072265625  |\n",
      "| explained_variance | -1.07        |\n",
      "| fps                | 68           |\n",
      "| n_updates          | 41           |\n",
      "| policy_entropy     | 2.9678023    |\n",
      "| policy_loss        | -0.023771033 |\n",
      "| serial_timesteps   | 5248         |\n",
      "| time_elapsed       | 89.7         |\n",
      "| total_timesteps    | 5248         |\n",
      "| value_loss         | 0.0019685589 |\n",
      "-------------------------------------\n",
      "------------------------------------\n",
      "| approxkl           | 0.002366711 |\n",
      "| clipfrac           | 0.017578125 |\n",
      "| explained_variance | -2.27       |\n",
      "| fps                | 68          |\n",
      "| n_updates          | 42          |\n",
      "| policy_entropy     | 2.8985653   |\n",
      "| policy_loss        | -0.01842171 |\n",
      "| serial_timesteps   | 5376        |\n",
      "| time_elapsed       | 91.5        |\n",
      "| total_timesteps    | 5376        |\n",
      "| value_loss         | 0.002921396 |\n",
      "------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0028212247 |\n",
      "| clipfrac           | 0.01953125   |\n",
      "| explained_variance | -16          |\n",
      "| fps                | 67           |\n",
      "| n_updates          | 43           |\n",
      "| policy_entropy     | 2.727889     |\n",
      "| policy_loss        | -0.016308056 |\n",
      "| serial_timesteps   | 5504         |\n",
      "| time_elapsed       | 93.4         |\n",
      "| total_timesteps    | 5504         |\n",
      "| value_loss         | 0.0025135535 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0029022442 |\n",
      "| clipfrac           | 0.033203125  |\n",
      "| explained_variance | -14.2        |\n",
      "| fps                | 70           |\n",
      "| n_updates          | 44           |\n",
      "| policy_entropy     | 2.7630188    |\n",
      "| policy_loss        | -0.014299568 |\n",
      "| serial_timesteps   | 5632         |\n",
      "| time_elapsed       | 95.3         |\n",
      "| total_timesteps    | 5632         |\n",
      "| value_loss         | 0.0023147538 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0023487343 |\n",
      "| clipfrac           | 0.021484375  |\n",
      "| explained_variance | -1.6         |\n",
      "| fps                | 70           |\n",
      "| n_updates          | 45           |\n",
      "| policy_entropy     | 2.8351898    |\n",
      "| policy_loss        | -0.023787765 |\n",
      "| serial_timesteps   | 5760         |\n",
      "| time_elapsed       | 97.1         |\n",
      "| total_timesteps    | 5760         |\n",
      "| value_loss         | 0.0015088979 |\n",
      "-------------------------------------\n",
      "--------------------------------------\n",
      "| approxkl           | 0.003383174   |\n",
      "| clipfrac           | 0.02734375    |\n",
      "| explained_variance | -6.14         |\n",
      "| fps                | 68            |\n",
      "| n_updates          | 46            |\n",
      "| policy_entropy     | 2.767811      |\n",
      "| policy_loss        | -0.0118945595 |\n",
      "| serial_timesteps   | 5888          |\n",
      "| time_elapsed       | 98.9          |\n",
      "| total_timesteps    | 5888          |\n",
      "| value_loss         | 0.0018752434  |\n",
      "--------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0054951496 |\n",
      "| clipfrac           | 0.087890625  |\n",
      "| explained_variance | -3.93        |\n",
      "| fps                | 71           |\n",
      "| n_updates          | 47           |\n",
      "| policy_entropy     | 2.7721267    |\n",
      "| policy_loss        | -0.018674687 |\n",
      "| serial_timesteps   | 6016         |\n",
      "| time_elapsed       | 101          |\n",
      "| total_timesteps    | 6016         |\n",
      "| value_loss         | 0.0030725007 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.005166732  |\n",
      "| clipfrac           | 0.072265625  |\n",
      "| explained_variance | -6.76        |\n",
      "| fps                | 70           |\n",
      "| n_updates          | 48           |\n",
      "| policy_entropy     | 2.7568529    |\n",
      "| policy_loss        | -0.020239295 |\n",
      "| serial_timesteps   | 6144         |\n",
      "| time_elapsed       | 103          |\n",
      "| total_timesteps    | 6144         |\n",
      "| value_loss         | 0.001575322  |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0023357992 |\n",
      "| clipfrac           | 0.015625     |\n",
      "| explained_variance | -22.2        |\n",
      "| fps                | 70           |\n",
      "| n_updates          | 49           |\n",
      "| policy_entropy     | 2.8430831    |\n",
      "| policy_loss        | -0.022799034 |\n",
      "| serial_timesteps   | 6272         |\n",
      "| time_elapsed       | 104          |\n",
      "| total_timesteps    | 6272         |\n",
      "| value_loss         | 0.0009444702 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0031195018 |\n",
      "| clipfrac           | 0.041015625  |\n",
      "| explained_variance | -12.9        |\n",
      "| fps                | 72           |\n",
      "| n_updates          | 50           |\n",
      "| policy_entropy     | 2.7206206    |\n",
      "| policy_loss        | -0.01435154  |\n",
      "| serial_timesteps   | 6400         |\n",
      "| time_elapsed       | 106          |\n",
      "| total_timesteps    | 6400         |\n",
      "| value_loss         | 0.0013185022 |\n",
      "-------------------------------------\n",
      "--------------------------------------\n",
      "| approxkl           | 0.00095344835 |\n",
      "| clipfrac           | 0.0078125     |\n",
      "| explained_variance | -17.3         |\n",
      "| fps                | 70            |\n",
      "| n_updates          | 51            |\n",
      "| policy_entropy     | 2.7875803     |\n",
      "| policy_loss        | -0.01313178   |\n",
      "| serial_timesteps   | 6528          |\n",
      "| time_elapsed       | 108           |\n",
      "| total_timesteps    | 6528          |\n",
      "| value_loss         | 0.0011184063  |\n",
      "--------------------------------------\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "--------------------------------------\n",
      "| approxkl           | 0.00098653    |\n",
      "| clipfrac           | 0.001953125   |\n",
      "| explained_variance | -4.97         |\n",
      "| fps                | 70            |\n",
      "| n_updates          | 52            |\n",
      "| policy_entropy     | 2.8630807     |\n",
      "| policy_loss        | -0.013609     |\n",
      "| serial_timesteps   | 6656          |\n",
      "| time_elapsed       | 110           |\n",
      "| total_timesteps    | 6656          |\n",
      "| value_loss         | 0.00043460756 |\n",
      "--------------------------------------\n",
      "--------------------------------------\n",
      "| approxkl           | 0.0021617394  |\n",
      "| clipfrac           | 0.01953125    |\n",
      "| explained_variance | -5.83         |\n",
      "| fps                | 72            |\n",
      "| n_updates          | 53            |\n",
      "| policy_entropy     | 2.7797117     |\n",
      "| policy_loss        | -0.011913329  |\n",
      "| serial_timesteps   | 6784          |\n",
      "| time_elapsed       | 112           |\n",
      "| total_timesteps    | 6784          |\n",
      "| value_loss         | 0.00082066684 |\n",
      "--------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0008222591 |\n",
      "| clipfrac           | 0.00390625   |\n",
      "| explained_variance | -7.08        |\n",
      "| fps                | 71           |\n",
      "| n_updates          | 54           |\n",
      "| policy_entropy     | 2.833537     |\n",
      "| policy_loss        | -0.015941361 |\n",
      "| serial_timesteps   | 6912         |\n",
      "| time_elapsed       | 113          |\n",
      "| total_timesteps    | 6912         |\n",
      "| value_loss         | 0.0007032367 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0014184254 |\n",
      "| clipfrac           | 0.017578125  |\n",
      "| explained_variance | -28.3        |\n",
      "| fps                | 72           |\n",
      "| n_updates          | 55           |\n",
      "| policy_entropy     | 2.7140934    |\n",
      "| policy_loss        | -0.014024768 |\n",
      "| serial_timesteps   | 7040         |\n",
      "| time_elapsed       | 115          |\n",
      "| total_timesteps    | 7040         |\n",
      "| value_loss         | 0.0008782122 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0015884313 |\n",
      "| clipfrac           | 0.013671875  |\n",
      "| explained_variance | -3.52        |\n",
      "| fps                | 72           |\n",
      "| n_updates          | 56           |\n",
      "| policy_entropy     | 2.763313     |\n",
      "| policy_loss        | -0.01653451  |\n",
      "| serial_timesteps   | 7168         |\n",
      "| time_elapsed       | 117          |\n",
      "| total_timesteps    | 7168         |\n",
      "| value_loss         | 0.0007462099 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0026966752 |\n",
      "| clipfrac           | 0.029296875  |\n",
      "| explained_variance | -14.4        |\n",
      "| fps                | 69           |\n",
      "| n_updates          | 57           |\n",
      "| policy_entropy     | 2.7797394    |\n",
      "| policy_loss        | -0.015155458 |\n",
      "| serial_timesteps   | 7296         |\n",
      "| time_elapsed       | 119          |\n",
      "| total_timesteps    | 7296         |\n",
      "| value_loss         | 0.0014343347 |\n",
      "-------------------------------------\n",
      "-------------------------------------\n",
      "| approxkl           | 0.0009096245 |\n",
      "| clipfrac           | 0.01171875   |\n",
      "| explained_variance | -3.86        |\n",
      "| fps                | 67           |\n",
      "| n_updates          | 58           |\n",
      "| policy_entropy     | 2.9111753    |\n",
      "| policy_loss        | -0.015380679 |\n",
      "| serial_timesteps   | 7424         |\n",
      "| time_elapsed       | 121          |\n",
      "| total_timesteps    | 7424         |\n",
      "| value_loss         | 0.0008800622 |\n",
      "-------------------------------------\n",
      "Trades:     step symbol            type    amount    price\n",
      "0     2    BTC   TradeType.BUY  2.279120  1994.39\n",
      "1     3    BTC  TradeType.SELL  1.139560 -1319.70\n",
      "2     4    BTC  TradeType.SELL  0.081397  1366.03\n",
      "3     6    BTC  TradeType.SELL  0.046007  1812.45\n",
      "4     7    BTC  TradeType.SELL  0.044007  1470.17\n",
      "5    11    BTC   TradeType.BUY  7.004290  1034.64\n",
      "6    14    BTC  TradeType.SELL  0.468967  1376.94\n",
      "7    15    BTC  TradeType.SELL  3.751736 -2605.11\n",
      "8    19    BTC  TradeType.SELL  1.875868  4946.33\n",
      "9    21    BTC  TradeType.SELL  0.081559 -2374.77\n",
      "10   23    BTC  TradeType.SELL  0.128165   127.56\n",
      "11   24    BTC  TradeType.SELL  0.083307  -191.49\n",
      "12   25    BTC  TradeType.SELL  0.316567  -807.35\n",
      "13   27    BTC  TradeType.SELL  0.063313 -2485.67\n",
      "14   29    BTC  TradeType.SELL  0.085925  1897.57\n",
      "15   30    BTC  TradeType.SELL  0.139629 -1794.40\n",
      "16   31    BTC  TradeType.SELL  0.195480   612.75\n",
      "17   33    BTC   TradeType.BUY  1.750050  4944.99\n",
      "18   38    BTC  TradeType.SELL  0.110086 -5482.71\n",
      "19   39    BTC  TradeType.SELL  0.484377   -49.09\n",
      "20   41    BTC  TradeType.SELL  0.968754 -1990.78\n",
      "21   44    BTC  TradeType.SELL  0.056986  2792.90\n",
      "22   45    BTC  TradeType.SELL  0.053633 -1100.48\n",
      "Balance:  75430.0071737541\n",
      "Portfolio:  {'BTC': 0.8581350600000001}\n",
      "P/L:  0.7376095855332863\n"
     ]
    }
   ],
   "source": [
    "from stable_baselines.common.policies import MlpLnLstmPolicy\n",
    "from stable_baselines.common.vec_env import DummyVecEnv\n",
    "from stable_baselines import PPO2\n",
    "\n",
    "import sys\n",
    "import os\n",
    "\n",
    "sys.path.append(os.path.dirname(os.path.abspath('../..')))\n",
    "\n",
    "from tensortrade.environments import TradingEnvironment\n",
    "from tensortrade.environments.actions.discrete import SimpleDiscreteStrategy\n",
    "from tensortrade.environments.rewards.simple import IncrementalProfitStrategy\n",
    "from tensortrade.exchanges.simulated import FBMExchange\n",
    "\n",
    "env = DummyVecEnv([lambda: TradingEnvironment(action_strategy=SimpleDiscreteStrategy(),\n",
    "                                              reward_strategy=IncrementalProfitStrategy(),\n",
    "                                              exchange=FBMExchange())])\n",
    "\n",
    "agent = PPO2(MlpLnLstmPolicy, env, verbose=1, nminibatches=1)\n",
    "\n",
    "agent.learn(7500)\n",
    "\n",
    "obs = env.reset()\n",
    "\n",
    "\n",
    "state = None\n",
    "exchange = None\n",
    "\n",
    "for _ in range(2500):\n",
    "    action, state = agent.predict(obs, state=state)\n",
    "    obs, reward , _, info = env.step(action)\n",
    "    \n",
    "    exchange = info[0]['exchange']\n",
    "    \n",
    "print('Trades: ', exchange.trades())\n",
    "print('Balance: ', exchange.balance()) \n",
    "print('Portfolio: ', exchange.portfolio()) \n",
    "print('P/L: ', exchange.profit_loss_percent())\n"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.9"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
